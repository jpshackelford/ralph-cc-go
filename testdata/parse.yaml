tests:
  - name: "empty main function"
    input: |
      int main() {}
    ast:
      kind: FunDef
      name: main
      return_type: int
      body:
        kind: Block
        items: []

  - name: "return zero"
    input: |
      int f() { return 0; }
    ast:
      kind: FunDef
      name: f
      return_type: int
      body:
        kind: Block
        items:
          - kind: Return
            expr:
              kind: Constant
              value: 0

  - name: "return integer literal"
    input: |
      int answer() { return 42; }
    ast:
      kind: FunDef
      name: answer
      return_type: int
      body:
        kind: Block
        items:
          - kind: Return
            expr:
              kind: Constant
              value: 42

  - name: "return variable"
    input: |
      int f() { return x; }
    ast:
      kind: FunDef
      name: f
      return_type: int
      body:
        kind: Block
        items:
          - kind: Return
            expr:
              kind: Variable
              name: x

  - name: "return parenthesized expression"
    input: |
      int f() { return (42); }
    ast:
      kind: FunDef
      name: f
      return_type: int
      body:
        kind: Block
        items:
          - kind: Return
            expr:
              kind: Paren
              expr:
                kind: Constant
                value: 42

  - name: "binary addition"
    input: |
      int f() { return 1 + 2; }
    ast:
      kind: FunDef
      name: f
      return_type: int
      body:
        kind: Block
        items:
          - kind: Return
            expr:
              kind: Binary
              op: "+"
              left:
                kind: Constant
                value: 1
              right:
                kind: Constant
                value: 2

  - name: "unary negation"
    input: |
      int f() { return -5; }
    ast:
      kind: FunDef
      name: f
      return_type: int
      body:
        kind: Block
        items:
          - kind: Return
            expr:
              kind: Unary
              op: "-"
              expr:
                kind: Constant
                value: 5

  - name: "precedence mul over add"
    input: |
      int f() { return 1 + 2 * 3; }
    ast:
      kind: FunDef
      name: f
      return_type: int
      body:
        kind: Block
        items:
          - kind: Return
            expr:
              kind: Binary
              op: "+"
              left:
                kind: Constant
                value: 1
              right:
                kind: Binary
                op: "*"
                left:
                  kind: Constant
                  value: 2
                right:
                  kind: Constant
                  value: 3

  - name: "logical and comparison"
    input: |
      int f() { return 1 < 2 && 3 > 4; }
    ast:
      kind: FunDef
      name: f
      return_type: int
      body:
        kind: Block
        items:
          - kind: Return
            expr:
              kind: Binary
              op: "&&"
              left:
                kind: Binary
                op: "<"
                left:
                  kind: Constant
                  value: 1
                right:
                  kind: Constant
                  value: 2
              right:
                kind: Binary
                op: ">"
                left:
                  kind: Constant
                  value: 3
                right:
                  kind: Constant
                  value: 4

  - name: "restrict keyword in parameter"
    input: |
      int foo(int * restrict ptr) { return *ptr; }
    ast:
      kind: FunDef
      name: foo
      return_type: int
      params:
        - type: int*
          name: ptr
      body:
        kind: Block
        items:
          - kind: Return
            expr:
              kind: Unary
              op: "*"
              expr:
                kind: Variable
                name: ptr

  - name: "restrict with const in parameter"
    input: |
      int bar(const char * restrict str) { return 0; }
    ast:
      kind: FunDef
      name: bar
      return_type: int
      params:
        - type: char*
          name: str
      body:
        kind: Block
        items:
          - kind: Return
            expr:
              kind: Constant
              value: 0

  - name: "signed char parameter"
    input: |
      int f(signed char c) { return 0; }
    ast:
      kind: FunDef
      name: f
      return_type: int
      params:
        - type: signed char
          name: c
      body:
        kind: Block
        items:
          - kind: Return
            expr:
              kind: Constant
              value: 0

  - name: "unsigned char parameter"
    input: |
      int f(unsigned char c) { return 0; }
    ast:
      kind: FunDef
      name: f
      return_type: int
      params:
        - type: unsigned char
          name: c
      body:
        kind: Block
        items:
          - kind: Return
            expr:
              kind: Constant
              value: 0

  - name: "unsigned short parameter"
    input: |
      int f(unsigned short s) { return 0; }
    ast:
      kind: FunDef
      name: f
      return_type: int
      params:
        - type: unsigned short
          name: s
      body:
        kind: Block
        items:
          - kind: Return
            expr:
              kind: Constant
              value: 0

  - name: "long long parameter"
    input: |
      int f(long long n) { return 0; }
    ast:
      kind: FunDef
      name: f
      return_type: int
      params:
        - type: long long
          name: n
      body:
        kind: Block
        items:
          - kind: Return
            expr:
              kind: Constant
              value: 0

  - name: "unsigned long long parameter"
    input: |
      int f(unsigned long long n) { return 0; }
    ast:
      kind: FunDef
      name: f
      return_type: int
      params:
        - type: unsigned long long
          name: n
      body:
        kind: Block
        items:
          - kind: Return
            expr:
              kind: Constant
              value: 0

  - name: "long double parameter"
    input: |
      int f(long double x) { return 0; }
    ast:
      kind: FunDef
      name: f
      return_type: int
      params:
        - type: long double
          name: x
      body:
        kind: Block
        items:
          - kind: Return
            expr:
              kind: Constant
              value: 0

  - name: "unsigned int return type"
    input: |
      unsigned int f() { return 0; }
    ast:
      kind: FunDef
      name: f
      return_type: unsigned
      params: []
      body:
        kind: Block
        items:
          - kind: Return
            expr:
              kind: Constant
              value: 0

  - name: "signed long return type"
    input: |
      signed long f() { return 0; }
    ast:
      kind: FunDef
      name: f
      return_type: long
      params: []
      body:
        kind: Block
        items:
          - kind: Return
            expr:
              kind: Constant
              value: 0

  - name: "__builtin_va_list parameter"
    input: |
      int f(__builtin_va_list ap) { return 0; }
    ast:
      kind: FunDef
      name: f
      return_type: int
      params:
        - type: __builtin_va_list
          name: ap
      body:
        kind: Block
        items:
          - kind: Return
            expr:
              kind: Constant
              value: 0

  - name: "string literal in function call"
    input: |
      void f() { printf("hello"); }
    ast:
      kind: FunDef
      name: f
      return_type: void
      body:
        kind: Block
        items:
          - kind: Computation
            expr:
              kind: Call
              func:
                kind: Variable
                name: printf
              args:
                - kind: StringLiteral
                  string_value: "hello"

  - name: "string literal with escape sequence"
    input: |
      void f() { puts("hello\nworld"); }
    ast:
      kind: FunDef
      name: f
      return_type: void
      body:
        kind: Block
        items:
          - kind: Computation
            expr:
              kind: Call
              func:
                kind: Variable
                name: puts
              args:
                - kind: StringLiteral
                  string_value: "hello\\nworld"



  - name: "character literal in declaration"
    input: |
      char f() { return 'x'; }
    ast:
      kind: FunDef
      name: f
      return_type: char
      body:
        kind: Block
        items:
          - kind: Return
            expr:
              kind: CharLiteral
              string_value: "x"

  - name: "character literal with escape newline"
    input: |
      char f() { return '\n'; }
    ast:
      kind: FunDef
      name: f
      return_type: char
      body:
        kind: Block
        items:
          - kind: Return
            expr:
              kind: CharLiteral
              string_value: "\\n"

  - name: "character literal in comparison"
    input: |
      int f(char c) { if (c == 'a') return 1; return 0; }
    ast:
      kind: FunDef
      name: f
      return_type: int
